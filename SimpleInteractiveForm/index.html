<HTML>
    <HEAD>
        <TITLE>Simple Interactive Form</TITLE>
        <link rel="stylesheet" href="default.css">
        <meta charset="UTF-8">
    </HEAD>

    <BODY>
        <p id="Title" class ="Head">Welcome to this small project!</p>
        <p id="SubTitle"></p>
        <br>
        <form id="Registerform" method="post">
            <h1>Sign Up Here!</h1>
            <div id="message">
                A simple sign up page with realtime checks for username and password requirements. <br>
                (Try inputting Bo_ in username to see all the valid error messages.)
            </div>
            <hr>
            <div id="message">Welcome to Small Project! Usernames must be unique and atleast 4 characters long. </div><br>

            <div class="rightDiv"><label for="User"  class="text" type="text">Username: </label>
            <input name="User" class="inputtext" type="text">
            </div>
            <p id="UserLen" class="Error"></p>
            <p id="UserExists" class="Error"></p>
            <p id="UserChar" class="Error"></p>
            <p id="ValidUser" class="Error"></p>

            <div id="message">Addtionally passwords should be atleast 7 characters long, include a number, and include a capital letter. </div><br>

            <div class="rightDiv">
                <label for="Pass" type="text">Password: </label>
                <input name="Pass" class="inputtext" type="password">
            </div>

            <p id="PassLen" class="Error"></p>
            <p id="PassNum" class="Error"></p>
            <p id="PassCapital" class="Error"></p>
            <p id="PassValid" class="Error"></p>
            <p id="PassChar" class="Error"></p>
            <br>
            
            <div class="rightDiv"><label for="ConfirmPass" class="text" type="text" >Confirm Password: </label> 
            <input name="ConfirmPass" class="inputtext" type="password"></div>
            <p id="PassCheck" class="Error"></p>
            <br>
            <div id="submit">
                <input name="Submit" type="submit" value ="Register" id="Register">
            </div>
            
        </form>
        <form id="PlayForm" method="post">
            <h1>Play Space!</h1>
            <div id="message">
                A few small and short games for you to play around with <br>
                Try inputting text or clicking things!
            </div>
            <hr>
        </form>
    </BODY>

    <script type="text/javascript">
        let text = "There isn't too much to do right now though."
        setTimeout(function(){document.getElementById("SubTitle").innerHTML = text}, 2000);
        setTimeout(function(){document.getElementById("Registerform").style.visibility = "visible" }, 0);

        //Event Listeners

        document.getElementsByName("User")[0].addEventListener('change', handleUserField);
        document.getElementsByName("Pass")[0].addEventListener('change', handlePassField);
        document.getElementsByName("ConfirmPass")[0].addEventListener('change', handleConfirmPassField);

        function handleConfirmPassField(repeat) {
            let enteredpass = document.getElementsByName("Pass")[0].value;
            document.getElementById("PassCheck").innerHTML = "";
            let checkPass = document.getElementsByName("ConfirmPass")[0].value;

            if (enteredpass != checkPass) {
                document.getElementById("PassCheck").innerHTML = "&#10060 Passwords don't match!";
            } else if (checkPass != "") {
                document.getElementById("PassCheck").innerHTML = "&#9989 Passwords Match";
            }

            if (repeat) {
                handlePassField();
            }
            
        }

        function handleUserField() {
            let commonNames = ["Bo_", "User", "Joey", "Admin"]; //Sudo database name grabber
            let blacklist = ["_", "%", "\\"];
            let valid = true;
            document.getElementById("UserLen").innerHTML = "";
            document.getElementById("UserExists").innerHTML = "";
            document.getElementById("UserChar").innerHTML = "";
            document.getElementById("ValidUser").innerHTML = "";

            if (this.value.length < 4 && this.value != "") {
                document.getElementById("UserLen").innerHTML = "&#10060 Username is too short";
                valid = false;
            }

            if (this.value == "") {
                valid = false;
            }

            if (commonNames.includes(this.value)) {
                document.getElementById("UserExists").innerHTML = "&#10060 This user already exists try adding a number to the end"
                valid = false;
            }
            
            for (let x = 0; x < blacklist.length; x++) {
                if (this.value.includes(blacklist[x])) {
                    valid = false;
                    document.getElementById("UserChar").innerHTML = "&#10060 Your username contains black listed characters";
                }
            }
            if (valid) {
                document.getElementById("ValidUser").innerHTML = "&#9989 Valid Username";
            }
        
        }

        function handlePassField() {
            let blacklist = ["_", "%", "\\"];
            let valid = true;
            let enteredpass = document.getElementsByName("Pass")[0].value;

            document.getElementById("PassLen").innerHTML = "";
            document.getElementById("PassNum").innerHTML = "";
            document.getElementById("PassCapital").innerHTML = "";
            document.getElementById("PassValid").innerHTML = "";
            document.getElementById("PassChar").innerHTML = "";

            if (enteredpass.length < 7 && enteredpass != "") {
                document.getElementById("PassLen").innerHTML = "&#10060 Password is too short";
                valid = false;
            }

            if (enteredpass == "") {
                valid = false;
            }

            let capital = false;
            for (let x = 0; x < enteredpass.length; x++) {
                if (/[A-Z]/.test(enteredpass.charAt(x)) == true) {
                    capital = true;
                    break;
                }
            }

            if (!capital && enteredpass != "") {
                document.getElementById("PassCapital").innerHTML = "&#10060 Password requires a capital letter";
                valid = false;
            }

            var hasNumber = /\d/;
            if (hasNumber.test(enteredpass) == false && enteredpass != "") {
                document.getElementById("PassNum").innerHTML = "&#10060 Password requires a number";
                valid = false;
            }

            for (let x = 0; x < blacklist.length; x++) {
                if (enteredpass.includes(blacklist[x])) {
                    valid = false;
                    document.getElementById("PassChar").innerHTML = "&#10060 Your password contains black listed characters";
                }
            }

            handleConfirmPassField(false);
            if (valid) {
                document.getElementById("PassValid").innerHTML = "&#9989 Valid Password";
            }
        }
        
    </script>
</HTML>